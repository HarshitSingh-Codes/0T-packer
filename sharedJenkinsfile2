@Library("opstree-shared-library@packer+aws-cli") _

def opstree = new org.opstree.template.nginx.nginx()

node {
    
    def url = 'https://github.com/HarshitSingh-Codes/0T-packer.git'
    def creds = 'github-token'
    def branch = 'nginxV1.0'
    def packerFileName = '.'
    def amiVersion = '0.8'
    def templateID = 'lt-0e0cf0cd693670427'
    def asgConfig = 'config.json'
    def sourceVersion = '8'

    opstree.checkout(url, creds, branch)

    opstree.runPacker(packerFileName, amiVersion)

    opstree.updateLaunchTemplate(templateID, sourceVersion)

    opstree.instanceRefresh(asgConfig)
}
